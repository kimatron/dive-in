{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/post_detail.css' %}">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="post-hero">
    {% if post.featured_image %}
    <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" class="post-hero__image">
    {% else %}
    <img src="{% static 'images/default-hero.jpg' %}" alt="{{ post.title }}" class="post-hero__image">
    {% endif %}
    <div class="post-hero__overlay"></div>
    
    <div class="post-container">
        <div class="post-hero__content">
            {% if post.category %}
            <span class="post-hero__category">{{ post.category.name }}</span>
            {% endif %}
            
            <h1 class="post-hero__title">{{ post.title }}</h1>
            
            <div class="post-hero__meta">
                <div class="post-hero__meta-item">
                    <img src="{{ post.author.userprofile.profile_picture.url }}" 
                         alt="{{ post.author.username }}" 
                         class="rounded-circle"
                         style="width: 40px; height: 40px; object-fit: cover;">
                    <span>By {{ post.author.username }}</span>
                </div>
                <div class="post-hero__meta-item">
                    <i class="far fa-calendar"></i>
                    <span>{{ post.created_on|date:"F j, Y" }}</span>
                </div>
                <div class="post-hero__meta-item">
                    <i class="far fa-comment"></i>
                    <span>{{ comment_count }} Comments</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="post-container">
    <div class="post-grid">
        <!-- Main Content Area -->
        <div class="post-main">
            <article class="post-card">
                <div class="post-content">
                    {{ post.content | safe }}
                </div>
            </article>
            
         
        </div>
        <!-- After the post content, before comments -->
<div class="author-section">
  <div class="author-card">
      <div class="author-card__header">
          <div class="author-card__avatar">
              {% if post.author.userprofile.profile_picture %}
                  <img src="{{ post.author.userprofile.profile_picture.url }}" 
                       alt="{{ post.author.username }}" 
                       class="author-card__image">
              {% else %}
                  <img src="{% static 'images/default-avatar.png' %}" 
                       alt="{{ post.author.username }}" 
                       class="author-card__image">
              {% endif %}
          </div>
          <div class="author-card__info">
              <h3 class="author-card__name">About {{ post.author.username }}</h3>
              {% if post.author.userprofile.bio %}
                  <p class="author-card__bio">{{ post.author.userprofile.bio }}</p>
              {% endif %}
          </div>
      </div>
      <div class="author-card__footer">
          <a href="#" class="author-card__link">View Profile</a>
          <a href="#" class="author-card__link">More Posts</a>
      </div>
  </div>
</div>
<div class="comments-section">
  <h3 class="comments-title">Comments ({{ comment_count }})</h3>

  {% if user.is_authenticated %}
  <!-- Comment Form -->
  <div class="comment-form-container">
      <form id="commentForm" method="post" class="comment-form">
          {% csrf_token %}
          {{ comment_form | crispy }}
          <button type="submit" class="btn-submit">Post Comment</button>
      </form>
  </div>
  {% else %}
  <div class="login-prompt">
      <p>Please <a href="{% url 'account_login' %}">login</a> to leave a comment.</p>
  </div>
  {% endif %}

  <!-- Comments List -->
  <div class="comments-list">
      {% if comments %}
          {% for comment in comments %}
          <div class="comment-card {% if not comment.approved %}comment-pending{% endif %}">
              <div class="comment-header">
                  <div class="comment-author">
                      {% if comment.author.userprofile.profile_picture %}
                          <img src="{{ comment.author.userprofile.profile_picture.url }}" 
                               alt="{{ comment.author.username }}" 
                               class="author-avatar">
                      {% else %}
                          <img src="{% static 'images/default-avatar.png' %}" 
                               alt="{{ comment.author.username }}" 
                               class="author-avatar">
                      {% endif %}
                      <div class="author-info">
                          <span class="author-name">{{ comment.author.username }}</span>
                          <span class="comment-date">{{ comment.created_on|timesince }} ago</span>
                      </div>
                  </div>
                  {% if user.is_authenticated and comment.author == user %}
                  <div class="comment-actions">
                      <button class="btn-edit" comment_id="{{ comment.id }}">
                          <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn-delete" comment_id="{{ comment.id }}">
                          <i class="fas fa-trash"></i>
                      </button>
                  </div>
                  {% endif %}
              </div>

              <div class="comment-content" id="comment{{ comment.id }}">
                  {{ comment.body | linebreaks }}
              </div>

              {% if not comment.approved %}
              <div class="pending-notice">
                  <i class="fas fa-clock"></i>
                  Your comment is awaiting approval
              </div>
              {% endif %}
          </div>
          {% endfor %}
      {% else %}
          <p class="no-comments">No comments yet. Be the first to comment!</p>
      {% endif %}
  </div>
</div>

<!-- Delete Comment Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title">Delete Comment</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
              Are you sure you want to delete this comment?
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <a id="deleteConfirm" href="#" class="btn btn-danger">Delete</a>
          </div>
      </div>
  </div>
</div>
        <div class="post-sidebar">
        </div>
    </div>
</div>
{% endblock %}